<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="metodo_pagamento.css">
    <title>Pagamento</title>
</head>
<body onload="showPaymentValue()">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script>
        async function getPaymentValue ( entrance_id ) {
            var res;
            await axios.get('http://localhost:3000/payment',  { params: {entrance_id: entrance_id} })
                .then(response => { res = response.data;} )
                .catch(error => console.log(error));
            return res;
        }
        var already_searched = 0;

        async function showPaymentValue () {
            if (already_searched == 0) {
                already_searched = 1;
                var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('='),
                sParameterName,
                i;
                //alert(sURLVariables[1]);  
                payment_value = await getPaymentValue( sURLVariables[1] );
                document.getElementById("payment_value").innerHTML = "R$ " + payment_value;
                if (payment_value == 'query send no rows') {
                        alert("Registro com placa fornecida não foi encontrado")
                }
                else if ( payment_value == 'Response is undefined') {
                    alert("Erro ao buscar registro")
                    document.getElementById("payment_value").innerHTML = "R$ 5,99";
                } 
                else
                    document.getElementById("payment_value").innerHTML = "R$ " + payment_value[0][3]; //idpagamento,idteste,CARTAO,20.990000000000002,2021-11-20T22:27:32.890Z
            }
        }
    </script>
    <header class="header_logo">
        <h2 class="header_title">Shopping X</h2>
        <h2>Pagamento de Estacionamento</h2>
        <br>
        <h2>Escolha o metodo de Pagamento</h2>
    </header>

    <!-- Valor a ser pago -->
    <div id="payment_value" class="valor"> R$ {{ valor }} </div>

    <!-- Seleção do método de pagamento -->
    <div class="wrapper">
        
        <div onclick="window.location.href='./metodos/pix.html'">Pix</div>
        <div onclick="window.location.href='./metodos/cartão_crédito.html'">Cartão de Crédito</div>
        <div onclick="window.location.href='./metodos/dinheiro.html'">Dinheiro</div>
        <div onclick="window.location.href='./metodos/cartão_debito.html'">Cartão de Débito</div>

    </div>

    
</body>
</html>